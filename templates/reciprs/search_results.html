{% load django_bootstrap5 %}

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ¤œç´¢çµæœ</title>
    {% bootstrap_css %}
    {% bootstrap_javascript %}
</head>
<body>
<div class="container-fluid">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="row bg-light p-3 align-items-center">
        <div class="col-md-3">
            <h2>ğŸ³ ãƒ¬ã‚·ãƒ”ã‚’æ¤œç´¢</h2>
        </div>
        <div class="col-md-5">
            <form class="d-flex" method="get" action="{% url 'search_recipes' %}">
                <input type="search" name="q" class="form-control me-2" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢" value="{{ request.GET.q }}">
                <button class="btn btn-outline-success" type="submit">æ¤œç´¢</button>
            </form>
        </div>
        <div class="col-md-4 text-end">
            {% if user.is_authenticated %}
                <span>{{ user.username }}ã§ãƒ­ã‚°ã‚¤ãƒ³ä¸­</span>
                <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-danger">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            {% else %}
                <a href="{% url 'login' %}" class="btn btn-sm btn-outline-primary">ãƒ­ã‚°ã‚¤ãƒ³</a>
                <a href="{% url 'register' %}" class="btn btn-sm btn-outline-secondary">æ–°è¦ç™»éŒ²</a>
            {% endif %}
        </div>
    </div>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="row mt-4">
        <!-- å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="col-md-2">
            <div class="list-group">
                <a href="{% url 'favorites' %}" class="list-group-item list-group-item-action">â™¡ ãŠæ°—ã«å…¥ã‚Šãƒ¬ã‚·ãƒ”</a>
                <a href="{% url 'shopping_list' %}" class="list-group-item list-group-item-action">ğŸ›’ è²·ã„ç‰©ãƒªã‚¹ãƒˆ</a>
                <a href="{% url 'post_recipe' %}" class="list-group-item list-group-item-action">ï¼‹ ãƒ¬ã‚·ãƒ”ã‚’æŠ•ç¨¿</a>
            </div>
        </div>

        <!-- ä¸­å¤®ï¼šæ¤œç´¢çµæœ -->
        <div class="col-md-7">
            {% if results %}
                <h4>ğŸ” æ¤œç´¢çµæœï¼š{{ results|length }}ä»¶ã®ãƒ¬ã‚·ãƒ”ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</h4>
            {% else %}
                <h4>ğŸ” æ¤œç´¢çµæœï¼šè©²å½“ã™ã‚‹ãƒ¬ã‚·ãƒ”ã¯ã‚ã‚Šã¾ã›ã‚“</h4>
            {% endif %}

            {% if results %}
                {% for recipe in results %}
                    <div class="card mb-3" style="max-width: 800px;">
                        <div class="row g-0">
                            <div class="col-md-4">
                                <img src="{{ recipe.image.url }}" class="img-fluid rounded-start" alt="ãƒ¬ã‚·ãƒ”ç”»åƒ" style="height: 180px; width: 130px; object-fit: cover;">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <h5 class="card-title d-flex justify-content-between">
                                        <span>{{ recipe.title }}</span>
                                        <span style="font-size: 14px; color: #666;">{{ recipe.cooking_time }}åˆ†</span>
                                    </h5>
                                    <p class="card-text">{{ recipe.message }}</p>
                                    <a href="{% url 'recipe_detail' recipe.id %}" class="btn btn-sm btn-primary">è©³ç´°ã‚’è¦‹ã‚‹</a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>ã€Œ{{ query }}ã€ã«è©²å½“ã™ã‚‹ãƒ¬ã‚·ãƒ”ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endif %}
        </div>

        <!-- å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div class="col-md-3">
            <h4>ğŸ‘ äººæ°—ãƒ¬ã‚·ãƒ”ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h4>
            {% for recipe in ranked_recipes %}
                <div class="mb-2 border-bottom pb-2">
                    <strong>{{ forloop.counter }}ä½ï¼š</strong>
                    <a href="{% url 'recipe_detail' recipe.id %}">{{ recipe.title }}</a><br>
                    <img src="{{ recipe.image.url }}" alt="ãƒ¬ã‚·ãƒ”ç”»åƒ" style="width: 200px; height: 100px; object-fit: cover;">
                    <br><small>â™¡ {{ recipe.favorited_by.count }}ä»¶</small>
                </div>
            {% empty %}
                <p>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            {% endfor %}
    </div>
</div>
</body>
</html>
